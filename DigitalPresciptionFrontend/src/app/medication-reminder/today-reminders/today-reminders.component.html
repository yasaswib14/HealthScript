<div class="reminders-container">
    <div class="reminders-header">
        <h2>üìÖ Today's Medication Schedule</h2>
        <p class="date-display">{{ currentDate | date:'fullDate' }}</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <div class="loader"></div>
        <p>Loading your medication schedule...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage" class="error-message">
        <div class="error-content">
            <span class="error-icon">‚ö†Ô∏è</span>
            <p>{{ errorMessage }}</p>
            <button (click)="loadReminders()" class="retry-button">
                Try Again
            </button>
        </div>
    </div>

    <!-- Reminders List -->
    <div *ngIf="!loading && reminders.length > 0" class="reminders-list">
        <div *ngFor="let reminder of reminders" class="reminder-card"
            [ngClass]="{'taken': reminder.taken, 'missed': isMissed(reminder)}">
            <div class="reminder-content">
                <div class="medication-info">
                    <h3>üíä {{ reminder.medication.medicationName }}</h3>
                    <div class="timing-info">
                        <span class="timing-badge">{{ reminder.medication.dosageTiming }}</span>
                        <span class="duration-badge">
                            Day {{ getDayNumber(reminder) }} of {{ reminder.medication.durationDays }}
                        </span>
                    </div>
                </div>

                <div class="reminder-status">
                    <div class="status-indicator" [ngClass]="{
                        'status-taken': reminder.taken,
                        'status-pending': !reminder.taken && !isMissed(reminder),
                        'status-missed': !reminder.taken && isMissed(reminder)
                    }">
                        <span *ngIf="reminder.taken">‚úÖ Taken</span>
                        <span *ngIf="!reminder.taken && !isMissed(reminder)">‚è≥ Pending</span>
                        <span *ngIf="!reminder.taken && isMissed(reminder)">‚ùå Missed</span>
                    </div>

                    <button type="button" *ngIf="!reminder.taken && !isMissed(reminder)"
                        (click)="markTaken(reminder.medication.id)" class="take-button">
                        Mark as Taken
                    </button>
                </div>
            </div>

            <div class="reminder-progress">
                <div class="progress-bar">
                    <div class="progress-filled" [style.width]="getProgressPercentage(reminder) + '%'">
                    </div>
                </div>
                <span class="progress-text">
                    {{ getDaysRemaining(reminder) }} days remaining
                </span>
            </div>

            <!-- Medication History -->
            <div class="medication-history" [class.completed-course]="isCourseCompleted(reminder)">
                <div class="history-header">
                    <div class="history-title">
                        <span class="history-icon">üìä</span>
                        <span>Medication History</span>
                    </div>
                    <div class="course-status" *ngIf="isCourseCompleted(reminder)">
                        ‚ú® Course Completed
                    </div>
                </div>

                <!-- Active and Upcoming Days -->
                <div class="history-section" *ngIf="getActiveDays(reminder).length > 0">
                    <div class="section-header">
                        <h4 class="section-title">Current & Upcoming Days</h4>
                    </div>
                    <div class="days-grid">
                        <div *ngFor="let day of getActiveDays(reminder)" class="day-item">
                            <div class="day-header">
                                <span class="day-number">Day {{ day.dayNumber }} - </span>
                                <span class="day-date">{{ formatDate(day.date) }}</span>
                            </div>
                            <div class="day-status" [ngClass]="{
                                'status-taken': day.taken && day.isToday,
                                'status-missed': day.missed && !day.taken,
                                'status-pending': day.isToday && !day.taken,
                                'status-future': !day.isToday && !day.taken && !day.missed
                            }">
                                {{ getStatusText(day) }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Completed Days -->
                <div class="history-section completed-section" *ngIf="getCompletedDays(reminder).length > 0">
                    <div class="section-header">
                        <h4 class="section-title">
                            <span class="title-icon">‚úÖ</span>
                            Completed Days
                        </h4>
                    </div>
                    <div class="days-grid">
                        <div *ngFor="let day of getCompletedDays(reminder)" class="day-item taken-item">
                            <div class="day-header">
                                <span class="day-number">Day {{ day.dayNumber }} - </span>
                                <span class="day-date">{{ formatDate(day.date) }}</span>
                            </div>
                            <div class="day-status status-taken">
                                Taken
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && reminders.length === 0 && !errorMessage" class="empty-state">
        <span class="empty-icon">üéâ</span>
        <h3>All Clear!</h3>
        <p>You have no medications scheduled for today.</p>
    </div>
</div>