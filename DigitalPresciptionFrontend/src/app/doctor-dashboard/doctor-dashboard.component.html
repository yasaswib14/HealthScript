<div class="doctor-dashboard">
    <h1 class="header">ğŸ‘¨â€âš•ï¸ Doctor Dashboard</h1>
    <p class="subtext">Welcome, Doctor</p>

    <div class="status-box">
        <strong>Status:</strong> {{ apiMessage }}
    </div>

    <hr>

    <h2>ğŸ“© Patient Messages</h2>

    <!-- âœ… Show loader while fetching -->
    <div *ngIf="isLoading">
        <p>Loading patient messages...</p>
    </div>

    <!-- âœ… Show messages once loaded -->
    <div *ngIf="!isLoading && messages && messages.length > 0">
        <div *ngFor="let msg of messages" class="message-card">
            <div class="message-header">
                <strong>From:</strong> {{ msg.sender?.username }}
            </div>

            <div class="message-body">
                <p><strong>Message:</strong> {{ msg.content }}</p>
                <p><strong>Time:</strong> {{ msg.timestamp | date:'medium' }}</p>
            </div>

            <!-- Respond form -->
            <form #prescriptionForm="ngForm" (ngSubmit)="respondToPatient(msg.id, prescriptionForm)"
                class="prescription-form">
                <input type="text" name="diagnosis" ngModel required placeholder="Enter diagnosis"
                    class="input-field" />
                <input type="text" name="medication" ngModel required placeholder="Enter medication"
                    class="input-field" />
                <button type="submit" [disabled]="prescriptionForm.invalid" class="respond-btn">
                    ğŸ’Š Send Prescription
                </button>
            </form>
        </div>
    </div>

    <!-- âœ… Show fallback when loaded but empty -->
    <div *ngIf="!isLoading && (!messages || messages.length === 0)">
        <p>No messages assigned to you yet ğŸ•Šï¸</p>
    </div>

    <hr>

    <button class="logout-btn" (click)="logout()">ğŸšª Logout</button>
</div>